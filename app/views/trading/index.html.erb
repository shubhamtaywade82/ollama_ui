<div data-controller="trading-chat theme" class="flex flex-col h-screen" style="background-color: var(--bg-primary);">
  <!-- Header -->
  <header data-theme-bg-secondary class="border-b px-4 py-3 shadow-sm" style="border-color: var(--border-color);">
    <div class="flex items-center justify-between max-w-7xl mx-auto">
      <div class="flex items-center gap-3">
        <div class="flex items-center gap-2">
          <a href="/" class="px-3 py-1.5 rounded-lg text-sm font-medium" data-theme-text-secondary style="color: var(--text-secondary);">Chat</a>
          <a href="/trading" class="px-3 py-1.5 rounded-lg text-sm font-medium" style="background-color: var(--accent-primary); color: white; opacity: 0.2;">Trading</a>
        </div>
        <div class="w-8 h-8 rounded-lg flex items-center justify-center" data-theme-accent style="background: linear-gradient(to bottom right, var(--accent-primary), var(--accent-secondary));">
          <span class="text-white font-bold text-sm">$</span>
        </div>
        <div>
          <h1 class="text-lg font-semibold" data-theme-text-primary style="color: var(--text-primary);">Trading Assistant</h1>
          <p class="text-xs" data-theme-text-secondary style="color: var(--text-secondary);" data-trading-chat-target="accountInfo">Connecting to broker...</p>
          <!-- Agent Mode Selector -->
          <div class="flex gap-2 mt-2" data-trading-chat-target="modeSelector">
            <button data-action="click->trading-chat#switchMode" data-mode="trading"
              class="px-2 py-1 text-xs rounded-md transition"
              data-theme-bg-tertiary
              style="background-color: var(--bg-tertiary); color: var(--text-primary);"
              data-trading-chat-target="tradingModeBtn">
              Trading Agent
            </button>
            <button data-action="click->trading-chat#switchMode" data-mode="technical_analysis"
              class="px-2 py-1 text-xs rounded-md transition opacity-60"
              data-theme-bg-tertiary
              style="background-color: var(--bg-tertiary); color: var(--text-primary);"
              data-trading-chat-target="technicalAnalysisModeBtn">
              Technical Analysis
            </button>
          </div>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <div class="text-right">
          <div class="text-xs" data-theme-text-secondary style="color: var(--text-secondary);">Account Value</div>
          <div data-trading-chat-target="accountValue" class="text-sm font-semibold" data-theme-text-primary style="color: var(--text-primary);">Loading...</div>
        </div>
        <!-- Theme Switcher -->
        <div class="relative" data-controller="theme">
          <button data-action="click->theme#toggleDropdown" class="p-2 rounded-lg transition hover:opacity-80" data-theme-bg-tertiary style="background-color: var(--bg-tertiary);" type="button">
            <span data-theme-target="themeIcon" data-theme-text-primary style="color: var(--text-primary); display: inline-flex; align-items: center;">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/></svg>
            </span>
          </button>
          <div data-theme-dropdown class="hidden absolute right-0 mt-2 w-48 rounded-lg shadow-lg z-50 py-2" data-theme-bg-secondary style="background-color: var(--bg-secondary); border: 1px solid var(--border-color);">
            <button data-action="click->theme#switch" data-theme="light" class="w-full px-4 py-2 text-left text-sm hover:opacity-80 transition flex items-center gap-2" data-theme-text-primary style="color: var(--text-primary);">
              <span class="w-4 h-4 rounded-full border-2" style="background: linear-gradient(135deg, #f9fafb 50%, #111827 50%); border-color: var(--border-color);"></span>
              Light
            </button>
            <button data-action="click->theme#switch" data-theme="dark" class="w-full px-4 py-2 text-left text-sm hover:opacity-80 transition flex items-center gap-2" data-theme-text-primary style="color: var(--text-primary);">
              <span class="w-4 h-4 rounded-full bg-gray-800 border-2" style="border-color: var(--border-color);"></span>
              Dark
            </button>
            <button data-action="click->theme#switch" data-theme="blue" class="w-full px-4 py-2 text-left text-sm hover:opacity-80 transition flex items-center gap-2" data-theme-text-primary style="color: var(--text-primary);">
              <span class="w-4 h-4 rounded-full border-2" style="background: #3b82f6; border-color: var(--border-color);"></span>
              Blue
            </button>
            <button data-action="click->theme#switch" data-theme="green" class="w-full px-4 py-2 text-left text-sm hover:opacity-80 transition flex items-center gap-2" data-theme-text-primary style="color: var(--text-primary);">
              <span class="w-4 h-4 rounded-full border-2" style="background: #10b981; border-color: var(--border-color);"></span>
              Green
            </button>
            <button data-action="click->theme#switch" data-theme="purple" class="w-full px-4 py-2 text-left text-sm hover:opacity-80 transition flex items-center gap-2" data-theme-text-primary style="color: var(--text-primary);">
              <span class="w-4 h-4 rounded-full border-2" style="background: #9333ea; border-color: var(--border-color);"></span>
              Purple
            </button>
            <button data-action="click->theme#switch" data-theme="orange" class="w-full px-4 py-2 text-left text-sm hover:opacity-80 transition flex items-center gap-2" data-theme-text-primary style="color: var(--text-primary);">
              <span class="w-4 h-4 rounded-full border-2" style="background: #f97316; border-color: var(--border-color);"></span>
              Orange
            </button>
            <button data-action="click->theme#switch" data-theme="red" class="w-full px-4 py-2 text-left text-sm hover:opacity-80 transition flex items-center gap-2" data-theme-text-primary style="color: var(--text-primary);">
              <span class="w-4 h-4 rounded-full border-2" style="background: #ef4444; border-color: var(--border-color);"></span>
              Red
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content Area with Sidebar -->
  <div class="flex-1 flex overflow-hidden" style="background-color: var(--bg-primary);">
    <!-- Left Sidebar - Agent Progress -->
    <div class="w-80 border-r flex flex-col" data-theme-bg-secondary style="border-color: var(--border-color); background-color: var(--bg-secondary);" data-trading-chat-target="progressSidebar">
      <div class="p-4 border-b" style="border-color: var(--border-color);">
        <h2 class="text-sm font-semibold" data-theme-text-primary style="color: var(--text-primary);">Agent Progress</h2>
        <p class="text-xs mt-1" data-theme-text-secondary style="color: var(--text-secondary);">Live execution details</p>
      </div>
      <div class="flex-1 overflow-y-auto p-4" data-trading-chat-target="progressContainer">
        <div class="text-xs text-center text-gray-400 py-8" data-theme-text-secondary style="color: var(--text-secondary);">
          Agent progress will appear here when processing requests...
        </div>
        <div data-trading-chat-target="progressLog" class="space-y-2"></div>
      </div>
    </div>

    <!-- Right Side - Chat Messages -->
    <div class="flex-1 overflow-y-auto" data-trading-chat-target="messagesContainer" style="background-color: var(--bg-primary);">
      <div class="max-w-4xl mx-auto px-4 py-6" data-trading-chat-target="messages">
      <div class="mb-4 flex justify-start">
        <div class="flex gap-3 max-w-[85%]">
          <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center" data-theme-accent style="background-color: var(--accent-primary);">
            ðŸ¤–
          </div>
          <div data-theme-bg-secondary class="rounded-2xl px-4 py-3 shadow-sm" data-theme-text-primary style="background-color: var(--bg-secondary); color: var(--text-primary);">
            <div class="prose prose-sm max-w-none">
              <p>Welcome to your <strong>Trading Assistant</strong>! I can help you with:</p>
              <ul>
                <li>ðŸ“Š Get real-time quotes for Indian stocks</li>
                <li>ðŸ’° View account balance, positions & holdings</li>
                <li>ðŸ“ˆ Track portfolio performance</li>
                <li>ðŸ’¡ Get trading insights</li>
                <li>ðŸ“‰ Advanced technical analysis with indicators (RSI, MACD, ADX, Supertrend)</li>
              </ul>
              <p><em>Try: "Get quote for RELIANCE" or "Analyze NIFTY with technical indicators"</em></p>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div data-theme-bg-secondary class="border-t" style="border-color: var(--border-color); background-color: var(--bg-secondary);">
    <form data-action="submit->trading-chat#submit" class="max-w-4xl mx-auto px-4 py-4">
      <div class="flex items-end gap-2">
        <div class="flex-1 relative">
          <textarea data-trading-chat-target="prompt" rows="1"
            placeholder="Ask about stocks, place orders, check account... (Enter to send, Shift+Enter for new line)"
            class="w-full rounded-xl border px-4 py-3 placeholder-gray-400 focus:outline-none focus:ring-2 focus:border-transparent resize-none overflow-hidden transition"
            style="border-color: var(--border-color); color: var(--text-primary); background-color: var(--bg-secondary); min-height: 3rem; max-height: 12rem; line-height: 1.5rem;"
            onfocus="this.style.setProperty('--tw-ring-color', 'var(--accent-primary)')"></textarea>
        </div>
        <button data-trading-chat-target="sendBtn" type="submit"
          class="rounded-xl text-white h-12 w-12 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed transition shadow-md hover:shadow-lg flex-shrink-0"
          style="background: linear-gradient(to right, var(--accent-primary), var(--accent-secondary));">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
        </button>
      </div>
    </form>
  </div>
</div>

